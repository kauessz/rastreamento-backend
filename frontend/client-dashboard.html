<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Minhas Opera√ß√µes - Rastreamento</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>
    <style>
        /* tema claro/escuro do widget alinhado ao site */
        df-messenger {
            --df-messenger-font-color: #101828;
            --df-messenger-button-titlebar-color: #1f6feb;
            --df-messenger-chat-background-color: #ffffff;
            --df-messenger-bot-message: #eef2ff;
            --df-messenger-user-message: #e7f5ff;
            --df-messenger-send-icon: #1f6feb;
            z-index: 9999;
        }

        body.dark-mode df-messenger {
            --df-messenger-font-color: #e5e7eb;
            --df-messenger-button-titlebar-color: #3b82f6;
            --df-messenger-chat-background-color: #0b1220;
            --df-messenger-bot-message: #0f172a;
            --df-messenger-user-message: #111827;
            --df-messenger-send-icon: #93c5fd;
        }

        .btn {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #d0d7de;
            background: #f6f8fa;
            cursor: pointer
        }

        body.dark-mode .btn {
            background: #0b1220;
            border-color: #1f2937;
            color: #e5e7eb
        }

        .btn:hover {
            filter: brightness(0.98);
        }
    </style>
</head>

<body>
    <header>
        <div class="logo">Portal do Cliente</div>
        <div class="header-right">
            <div class="user-profile">
                <span class="user-profile-icon">üë§</span>
                <span id="userEmail"></span>
            </div>
            <div class="theme-switch-wrapper">
                <label class="theme-switch" for="checkbox">
                    <input type="checkbox" id="checkbox" />
                    <div class="slider round"></div>
                </label>
            </div>
            <button id="logoutButton" class="button-logout">Sair</button>
        </div>
    </header>

    <main class="dashboard-container">
        <section class="dashboard-section">
            <h2>Minha Vis√£o Geral</h2>
            <div class="kpi-container">
                <div class="kpi-card" id="kpi-total"><span class="kpi-value">0</span><span class="kpi-label">Total de
                        Opera√ß√µes</span></div>
                <div class="kpi-card" id="kpi-ontime"><span class="kpi-value">0</span><span class="kpi-label">On
                        Time</span></div>
                <div class="kpi-card" id="kpi-atrasadas"><span class="kpi-value">0</span><span
                        class="kpi-label">Atrasadas</span></div>
                <div class="kpi-card" id="kpi-percentual"><span class="kpi-value">0%</span><span class="kpi-label">% de
                        Atraso</span></div>
            </div>
        </section>

        <section class="dashboard-section">
            <h2>Minhas Opera√ß√µes</h2>
            <div class="filters">
                <input type="text" id="bookingFilter" placeholder="Filtrar por Booking...">
                <input type="date" id="dataPrevisaoFilter">
                <button id="filterButton">Filtrar</button>
                <button id="clearFilterButton" class="button-secondary">Limpar</button>
            </div>
            <!-- Barra de Relat√≥rios (Cliente) -->
            <div class="report-bar" style="display:flex; gap:.5rem; align-items:center; margin:12px 0;">
                <label>Per√≠odo:</label>
                <input type="date" id="repStartClient" />
                <input type="date" id="repEndClient" />
                <button id="btnExcelTopClient" class="btn">Top 10 (Excel)</button>
                <button id="btnExcelAtrasosClient" class="btn">Resumo de Atrasos (Excel)</button>
            </div>
            <div class="table-wrapper">
                <table id="clientOperationsTable" class="operations-table">
                    <thead>
                        <tr>
                            <th>Booking</th>
                            <th>Cont√™iner(es)</th>
                            <th>Status</th>
                            <th>Previs√£o Atendimento</th>
                            <th>In√≠cio da Execu√ß√£o</th>
                            <th>Fim da Execu√ß√£o</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div id="paginationControls"></div>
        </section>
    </main>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="js/firebase-init.js"></script>
    <script src="js/client-dashboard.js"></script>
    <!-- Chat do Assistente (Dialogflow Messenger) -->
    <df-messenger chat-title="Assistente de Rastreamento" agent-id="e2079c6f-de5e-4822-990f-011b81ffacaf" language-code="pt-br" expand="false">
    </df-messenger>

    <script>
        // Esses valores podem vir do seu backend/login.
        // Ex.: preencha window.CLIENT_COMPANY_ID em js/client-dashboard.js ap√≥s buscar o perfil.
        window.CLIENT_COMPANY_ID = window.CLIENT_COMPANY_ID || 123; // embarcador_id do cliente (placeholder)
        window.AUTH_EMAIL = window.AUTH_EMAIL || ''; // ser√° setado pelo Firebase no JS

        // Define session-id: client:<companyId>:<email>
        (function setDfSessionId() {
            const df = document.querySelector('df-messenger');
            if (!df) return setTimeout(setDfSessionId, 300);

            // tenta pegar e-mail da UI (preenchido pelo Firebase)
            const emailEl = document.getElementById('userEmail');
            const email = emailEl && emailEl.textContent ? emailEl.textContent.replace('Ol√°, ', '') : window.AUTH_EMAIL || 'cliente@exemplo.com';

            df.setAttribute('session-id', `client:${window.CLIENT_COMPANY_ID}:${email}`);
        })();

        // Fun√ß√£o usada pelo bot√£o "Perguntar ao Assistente"
        window.openAssistant = function () {
            const df = document.querySelector('df-messenger');
            if (df) df.setAttribute('expanded', 'true');
        };
    </script>


</body>

</html>