<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard Admin ‚Äî Rastreamento</title>
  <link rel="stylesheet" href="/css/style.css?v=1">

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Firebase 8.x (mesmo usado no restante do projeto) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

  <script>
    // Se j√° existe um init global, remova/ignore.
    // Coloque aqui seu config do Firebase somente se esta p√°gina
    // ainda n√£o o carrega por outro script compartilhado.
    // window.firebase.initializeApp({ ... });
  </script>
  <style>
    /* pequenos utilit√°rios usados nesta p√°gina */
    .btn{padding:8px 12px;border:1px solid #d0d7de;border-radius:8px;background:#f6f8fa;cursor:pointer}
    .btn:hover{filter:brightness(.98)}
    .button-secondary{background:#eef2ff;border-color:#c7d2fe}
    .table-wrapper{overflow:auto}
    .op-details{font-size:.9rem;color:var(--muted)}
    .kpi-card .kpi-value{font-variant-numeric:tabular-nums}
  </style>
</head>
<body>
<header>
  <div class="logo">Dashboard <b>Admin</b></div>
  <div class="header-right">
    <button id="navReports" class="btn">Relat√≥rios</button>
    <div class="user-profile">
      <span class="user-profile-icon">üë§</span>
      <span id="userEmail"></span>
    </div>
    <button id="logoutButton" class="button-logout">Sair</button>
  </div>
</header>

<main class="dashboard-container">

  <!-- Caixa de gest√£o -->
  <section class="dashboard-section">
    <div class="management-container">
      <div class="management-box">
        <h3>Upload de Planilha</h3>
        <form id="uploadForm" class="filters">
          <input type="file" id="fileInput" required />
          <button type="submit" class="btn">Enviar</button>
        </form>
        <button id="wipeAllBtn" class="btn button-secondary" title="(opcional) limpar dados em dev">Limpar Todas as Opera√ß√µes</button>
      </div>

      <div class="management-box">
        <h3>Usu√°rios Pendentes</h3>
        <div id="pendingUsers">‚Äî</div>
      </div>
    </div>
  </section>

  <!-- Gerenciador de Apelidos -->
  <section class="dashboard-section">
    <h2>Gerenciador de Apelidos de Embarcadores</h2>
    <p class="muted">Vincule varia√ß√µes (ex.: ‚ÄúAmbev S.A.‚Äù) ao cliente mestre (ex.: ‚ÄúAMBEV‚Äù).</p>

    <div class="filters" style="gap:.5rem;flex-wrap:wrap">
      <input id="aliasInput" placeholder="Nome 'sujo' (apelido)" />
      <input id="masterInput" placeholder="Associado ao Mestre (ex: AMBEV)" />
      <button id="aliasSaveBtn" class="btn">Salvar / Atualizar</button>
      <span id="aliasMsg" class="muted"></span>
    </div>

    <div class="table-wrapper" style="margin-top:8px">
      <table class="operations-table">
        <thead>
          <tr>
            <th>Nome "Sujo" (Apelido)</th>
            <th>Associado ao Mestre</th>
          </tr>
        </thead>
        <tbody id="aliasesBody">
          <tr><td colspan="2" class="muted">Carregando...</td></tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- Filtros -->
  <section class="dashboard-section">
    <h2>Filtros de Opera√ß√µes</h2>
    <div class="filters" style="gap:.5rem;flex-wrap:wrap">
      <select id="embarcadorFilter">
        <option value="">Todos Embarcadores</option>
      </select>
      <input id="bookingFilter" placeholder="Booking" />
      <input id="containerFilter" placeholder="Cont√™iner" />
      <input id="startDateFilter" type="date" />
      <input id="endDateFilter" type="date" />
      <button id="filterButton" class="btn">Filtrar</button>
      <button id="clearFilterButton" class="btn button-secondary">Limpar Filtros</button>
    </div>
  </section>

  <!-- KPIs -->
  <section class="dashboard-section">
    <h2>Vis√£o Geral das Opera√ß√µes</h2>
    <div class="kpi-container">
      <div class="kpi-card">
        <span class="kpi-value" id="kpiTotalValue">0</span>
        <span class="kpi-label">Total de Opera√ß√µes</span>
      </div>
      <div class="kpi-card">
        <span class="kpi-value" id="kpiOnTimeValue">0</span>
        <span class="kpi-label">On Time</span>
      </div>
      <div class="kpi-card">
        <span class="kpi-value" id="kpiLateValue">0</span>
        <span class="kpi-label">Atrasadas</span>
      </div>
      <div class="kpi-card">
        <span class="kpi-value" id="kpiPctValue">0%</span>
        <span class="kpi-label">% de Atraso</span>
      </div>
    </div>

    <div class="charts-wrapper">
      <div class="chart-container">
        <h3>Top 10 Ofensores de Atraso</h3>
        <canvas id="ofensoresChart"></canvas>
      </div>
      <div class="chart-container">
        <h3>Top 10 Clientes com Atraso</h3>
        <canvas id="clientesChart"></canvas>
      </div>
    </div>
  </section>

  <!-- Barra de relat√≥rios (Excel) -->
  <div class="report-bar" style="display:flex;gap:.5rem;align-items:center;margin:12px 0;">
    <label>Per√≠odo:</label>
    <input type="date" id="repStart" />
    <input type="date" id="repEnd" />
    <button id="btnExcelTop" class="btn">Top 10 (Excel)</button>
    <button id="btnExcelAtrasos" class="btn">Resumo de Atrasos (Excel)</button>
  </div>

  <!-- Tabela -->
  <section class="dashboard-section">
    <h2>Lista de Opera√ß√µes</h2>
    <div class="table-wrapper">
      <table id="operationsTable" class="operations-table">
        <thead>
        <tr>
          <th>Booking</th>
          <th>Cont√™iner</th>
          <th>Embarcador</th>
          <th>Porto</th>
          <th>Previs√£o Atendimento</th>
          <th>In√≠cio Execu√ß√£o</th>
          <th>Fim Execu√ß√£o</th>
          <th>Status</th>
        </tr>
        </thead>
        <tbody id="operationsBody">
        <tr><td colspan="8" class="muted">Carregando...</td></tr>
        </tbody>
      </table>
    </div>

    <div class="pagination" id="paginationControls">
      <button id="prevPage" class="btn">‚Üê Anterior</button>
      <button id="nextPage" class="btn">Pr√≥xima ‚Üí</button>
    </div>
  </section>

</main>

<!-- Script da p√°gina -->
<script src="dashboard.js"></script>
</body>
</html>